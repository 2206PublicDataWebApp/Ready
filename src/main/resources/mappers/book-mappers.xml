<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="BookMapper">
	<resultMap type="Book" id="bookResultMap">
		<id 	property="bookNo" 		column="BOOK_NO"/>
		<result property="bookTitle" 	column="BOOK_TITLE"/>
		<result property="bookWriter" 	column="BOOK_WRITER"/>
		<result property="enrollDate" 	column="ENROLL_DATE"/>
		<result property="pubDate" 		column="PUB_DATE"/>
		<result property="category" 	column="BOOK_CATEGORY"/>
		<result property="bookContents" column="BOOK_CONTENTS"/>
		<result property="ISBN" 		column="BOOK_ISBN"/>
		<result property="priceSales" 	column="BOOK_PRICE"/>
		<result property="mileage" 		column="BOOK_MILEAGE"/>
		<result property="imgPath" 		column="IMG_PATH"/>
		<result property="publisher" 	column="BOOK_PUBLISHER"/>
	</resultMap>
	
	<resultMap type="Review" id="reviewResultMap">
		<id 	property="reviewNo" 		column="REVIEW_NO"/>
		<result property="bookNo" 			column="BOOK_NO"/>
		<result property="userId" 			column="USER_ID"/>
		<result property="nickName" 		column="USER_NICKNAME"/>
		<result property="score" 			column="SCORE"/>
		<result property="reviewContents" 	column="REVIEW_CONTENTS"/>
		<result property="enrollDate" 		column="ENROLL_DATE"/>
		<result property="updateDate" 		column="UPDATE_DATE"/>
	</resultMap>
	
	<insert id="insertBook">
		INSERT INTO BOOK_TBL VALUES(SEQ_BOOK_NO.NEXTVAL, #{bookTitle }, #{bookWriter }, DEFAULT, #{pubDate }, #{category }, #{bookContents}, #{ISBN }, #{priceSales }, #{mileage }, #{imgPath }, #{publisher })
	</insert>
	
	<select id="selectAllBook" resultMap="bookResultMap">
		SELECT * FROM BOOK_TBL
	</select>
	
	<select id="selectTotalCount" resultType="_int">
		SELECT COUNT(*) FROM BOOK_TBL
		<where>
			<if test="searchCondition.toString() == 'title'">
				BOOK_TITLE LIKE '%' ||#{searchValue }|| '%'
			</if>
			<if test="searchCondition.toString() == 'contents'">
				BOOK_CONTENTS LIKE '%' ||#{searchValue }|| '%'
			</if>
			<if test="searchCondition.toString() == 'writer'">
				BOOK_WRITER LIKE '%' ||#{searchValue }|| '%'
			</if>
			<if test="searchCondition.toString() == 'writer'">
				BOOK_WRITER LIKE '%' ||#{searchValue }|| '%'
				OR BOOK_CONTENTS LIKE '%' ||#{searchValue }|| '%'
				OR BOOK_WRITER LIKE '%' ||#{searchValue }|| '%'
			</if>
		</where>
	</select>
	
	<select id="selectAllByValue" resultMap="bookResultMap">
		SELECT * FROM BOOK_TBL
		<where>
			<if test="searchCondition.toString() == 'title'">
				BOOK_TITLE LIKE '%' ||#{searchValue }|| '%'
			</if>
			<if test="searchCondition.toString() == 'contents'">
				BOOK_CONTENTS LIKE '%' ||#{searchValue }|| '%'
			</if>
			<if test="searchCondition.toString() == 'writer'">
				BOOK_WRITER LIKE '%' ||#{searchValue }|| '%'
			</if>
			<if test="searchCondition.toString() == 'writer'">
				BOOK_WRITER LIKE '%' ||#{searchValue }|| '%'
				OR BOOK_CONTENTS LIKE '%' ||#{searchValue }|| '%'
				OR BOOK_WRITER LIKE '%' ||#{searchValue }|| '%'
			</if>
		</where>
	</select>
	
	<select id="selectOneBook" resultMap="bookResultMap">
		SELECT * FROM BOOK_TBL WHERE BOOK_NO = #{bookNo }
	</select>
	
	
	<!-- 리뷰관련 -->
	<insert id="insertReview">
		INSERT INTO REVIEW_TBL VALUES(SEQ_REVIEW_NO.NEXTVAL, #{bookNo }, #{userId }, #{nickName }, #{score }, #{reviewContents}, DEFAULT, DEFAULT)
	</insert>
	
	<update id="updateReview">
		UPDATE REVIEW_TBL SET REVIEW_CONTENTS = #{reviewContents}, R_UPDATE_DATE = DEFAULT WHERE REVIEW_NO = #{reviewNo }
	</update>
	
	<delete id="deleteReview">
		DELETE FROM REVIEW_TBL WHERE REVIEW_NO = #{reviewNo }
	</delete>
	
	<select id="selectAllReview" resultMap="reviewResultMap">
		SELECT * FROM REVIEW_TBL WHERE BOOK_NO = #{bookNo }
	</select>
</mapper>